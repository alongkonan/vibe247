<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VIBE 24 - Music & Rewards</title>
    
    <!-- PWA Settings -->
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://img5.pic.in.th/file/secure-sv1/vide.png">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        vibe: { red: '#E31E24', black: '#000000', white: '#FFFFFF', grey: '#333333', darkgrey: '#1a1a1a' }
                    },
                    fontFamily: {
                        sans: ['Prompt', 'sans-serif'],
                        montserrat: ['Montserrat', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Prompt', sans-serif; background-color: #000000; color: #FFFFFF; overflow-x: hidden; overscroll-behavior-y: none; }
        .vibe-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; background: linear-gradient(135deg, #111111 0%, #000000 100%); }
        .vibe-card { background: rgba(40, 40, 40, 0.6); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7); }
        #artwork-image { width: 100%; max-width: 250px; height: auto; aspect-ratio: 1/1; object-fit: cover; border-radius: 8px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); margin: 0 auto; display: block; transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1); border: 1px solid #333; }
        .art-shrink { max-width: 180px !important; }
        @media (min-width: 1024px) { #artwork-image { max-width: 300px; } .art-shrink { max-width: 220px !important; } }
        .is-playing #artwork-image { box-shadow: 0 20px 40px rgba(227, 30, 36, 0.25); border-color: #E31E24; }
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #FFFFFF; border: 2px solid #E31E24; cursor: pointer; margin-top: -6px; box-shadow: 0 0 10px rgba(227, 30, 36, 0.5); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #333333; border-radius: 2px; }
        .equalizer { display: flex; align-items: flex-end; height: 20px; gap: 3px; opacity: 0; transition: opacity 0.3s; }
        .is-playing .equalizer { opacity: 1; }
        .bar { width: 4px; background: #E31E24; animation: bounce 1s infinite ease-in-out; }
        .bar:nth-child(1) { animation-duration: 0.8s; height: 40%; }
        .bar:nth-child(2) { animation-duration: 1.1s; height: 70%; }
        .bar:nth-child(3) { animation-duration: 0.9s; height: 50%; }
        .bar:nth-child(4) { animation-duration: 1.2s; height: 80%; }
        .bar:nth-child(5) { animation-duration: 0.7s; height: 60%; }
        @keyframes bounce { 0%, 100% { height: 20%; } 50% { height: 100%; } }
        .marquee-container { width: 100%; overflow: hidden; white-space: nowrap; position: relative; box-sizing: border-box; }
        .marquee-content { display: inline-block; animation: marquee 15s linear infinite; padding-left: 100%; color: white; }
        @keyframes marquee { 0% { transform: translate(0, 0); } 100% { transform: translate(-100%, 0); } }
        .click-pulse { animation: clickPulse 0.3s ease-out; }
        @keyframes clickPulse { 0% { transform: scale(1); } 50% { transform: scale(0.9); } 100% { transform: scale(1); } }
        .modal-overlay { background-color: rgba(0, 0, 0, 0.9); backdrop-filter: blur(8px); }
        
        /* Reward Card Styles */
        .reward-card {
            background: linear-gradient(180deg, rgba(30,30,30,0.8) 0%, rgba(10,10,10,1) 100%);
            border: 1px solid #333;
            transition: all 0.3s ease;
        }
        .reward-card:hover {
            border-color: #E31E24;
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center relative p-4 overflow-y-auto py-8 lg:py-0">

    <div class="vibe-bg"></div>

    <!-- Points Button (Top Right) -->
    <button id="points-btn" class="fixed top-4 right-4 z-50 bg-black/80 border border-vibe-red/50 text-white font-bold text-sm py-2 px-4 rounded-full shadow-lg flex items-center gap-2 font-montserrat hover:bg-vibe-red transition-all">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-yellow-400" viewBox="0 0 20 20" fill="currentColor">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
        </svg>
        <span id="user-points-display">VIBE POINTS</span>
    </button>

    <main class="w-full max-w-6xl grid grid-cols-1 lg:grid-cols-12 gap-6 items-center relative z-10">
        
        <!-- PLAYER COLUMN -->
        <div class="col-span-12 lg:col-span-7 xl:col-span-8">
            <div class="vibe-card w-full rounded-2xl p-6 md:p-8 flex flex-col lg:flex-row items-center gap-6 lg:gap-10 transition-all duration-300">
                <div class="w-full lg:w-auto flex-shrink-0 flex flex-col items-center">
                    <div id="artwork-wrapper" class="w-full flex justify-center lg:block">
                         <div id="artwork-container" class="flex justify-center">
                             <img id="artwork-image" src="https://img2.pic.in.th/1000074512.png" alt="Album Art">
                         </div>
                    </div>
                </div>
                <div class="w-full flex flex-col items-center lg:items-start lg:flex-1 space-y-4">
                    <div class="w-full flex justify-between items-center lg:mb-2">
                        <div class="flex items-center gap-2">
                            <span class="flex h-3 w-3 relative"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-vibe-red opacity-75"></span><span class="relative inline-flex rounded-full h-3 w-3 bg-vibe-red"></span></span>
                            <span class="text-xs font-bold tracking-widest text-vibe-red uppercase font-montserrat">LIVE 24/7</span>
                        </div>
                        <img src="https://img2.pic.in.th/1000074512.png" alt="VIBE 24" class="h-10 lg:h-12 object-contain drop-shadow-md">
                    </div>
                    <div class="w-full space-y-1 lg:space-y-2">
                        <div class="w-full text-center lg:text-left">
                            <p id="track-artist" class="text-xl text-gray-400 font-medium truncate uppercase tracking-wide">VIBE 24</p>
                        </div>
                        <div class="w-full relative flex items-center justify-center lg:justify-start">
                            <h2 id="track-title" class="text-2xl md:text-3xl font-extrabold text-white text-center lg:text-left leading-tight line-clamp-2 transition-all duration-300 tracking-tight">
                                MUSIC STATION
                            </h2>
                        </div>
                        <div class="flex items-center justify-center lg:justify-start w-full pt-2">
                            <div class="flex items-center gap-2 text-sm text-gray-300 bg-vibe-grey py-1.5 px-4 rounded-md w-full max-w-sm lg:max-w-md border-l-4 border-vibe-red overflow-hidden">
                                <span class="text-vibe-red font-bold whitespace-nowrap flex-shrink-0 z-10 font-montserrat">NEXT:</span>
                                <div class="marquee-container w-full h-6 flex items-center">
                                    <span id="next-song-display" class="marquee-content font-medium" style="animation-duration: 12s;">
                                        Stay Tuned
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="w-full flex flex-col items-center lg:items-start gap-6 mt-2">
                        <div class="flex items-center justify-center lg:justify-start gap-8 w-full">
                            <div class="equalizer h-8 w-12 hidden md:flex lg:hidden"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
                            <button id="play-btn" class="group relative flex items-center justify-center w-20 h-20 rounded-full bg-vibe-white hover:bg-gray-100 text-vibe-black shadow-lg hover:shadow-vibe-red/50 transition-all duration-300 transform hover:scale-105 active:scale-95 border-4 border-transparent hover:border-vibe-red">
                                <svg id="icon-play" xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 ml-1 text-vibe-red" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                                <svg id="icon-pause" xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 hidden text-vibe-red" fill="currentColor" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                            </button>
                            <div class="equalizer h-12 w-16 hidden lg:flex gap-[3px]"><div class="bar w-1.5"></div><div class="bar w-1.5"></div><div class="bar w-1.5"></div><div class="bar w-1.5"></div><div class="bar w-1.5"></div><div class="bar w-1.5"></div></div>
                        </div>
                        <div class="w-full flex items-center gap-3 px-4 lg:px-0 max-w-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" /></svg>
                            <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="0.8" class="w-full h-2 rounded-lg appearance-none cursor-pointer flex-1" style="background: #333;">
                            <button id="share-btn" class="ml-2 text-gray-400 hover:text-vibe-red transition-all duration-200 p-2 rounded-full hover:bg-white/10" title="‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏û‡∏•‡∏á‡∏ô‡∏µ‡πâ"><svg id="icon-share" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" /></svg></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN -->
        <div class="col-span-12 lg:col-span-5 xl:col-span-4 flex flex-col gap-6">
            <div id="dj-card" class="w-full relative rounded-2xl overflow-hidden shadow-2xl group transition-all duration-300 hover:shadow-vibe-red/20 bg-vibe-darkgrey border border-gray-800">
                <div class="flex flex-row lg:block relative h-full">
                    <div class="w-[120px] sm:w-[140px] lg:w-full aspect-[3/4] lg:aspect-[3/4] relative flex-shrink-0 bg-black">
                        <img id="dj-image" src="https://img5.pic.in.th/file/secure-sv1/vide-djb72e78e3ef1fd50e.png" alt="DJ Station" class="w-full h-full object-contain transition-transform duration-700 group-hover:scale-105" style="object-position: center; padding: 10px;">
                        <div class="hidden lg:block absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent"></div>
                    </div>
                    <div class="flex-1 p-4 flex flex-col justify-center lg:absolute lg:bottom-0 lg:left-0 lg:w-full lg:p-6 lg:justify-end z-10 relative bg-gradient-to-r from-vibe-darkgrey to-transparent lg:bg-none">
                        <h3 id="dj-name" class="font-bold text-xl lg:text-4xl text-white leading-tight lg:leading-none tracking-tight mb-1 lg:mb-2 drop-shadow-lg line-clamp-1 lg:line-clamp-none pr-14 lg:pr-0">VIBE 24</h3>
                        <div class="flex flex-wrap items-center gap-2 mb-0 lg:mb-4">
                            <span class="px-2 py-0.5 rounded-sm text-[10px] font-bold bg-white text-vibe-black hidden lg:inline-block font-montserrat">HOST</span>
                            <p id="dj-time" class="text-sm lg:text-lg text-gray-300 font-medium tracking-wide drop-shadow-md">Hits 24 Hours</p>
                        </div>
                        <div class="hidden lg:block w-12 h-1 bg-vibe-red mb-3"></div>
                        <div class="hidden lg:flex items-center justify-end w-full">
                            <img src="https://img2.pic.in.th/1000074512.png" class="h-5 w-auto opacity-80 filter grayscale hover:grayscale-0 transition-all">
                        </div>
                    </div>
                </div>
            </div>
            
            <button id="open-request-btn" class="w-full rounded-xl bg-vibe-red hover:bg-red-700 text-white p-4 flex items-center justify-center gap-3 transition-all duration-300 shadow-lg hover:shadow-vibe-red/40 group border border-white/10 cursor-pointer">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 group-hover:scale-110 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" /></svg>
                <span class="text-lg font-bold font-montserrat">REQUEST A SONG</span>
            </button>
        </div>
    </main>

    <!-- REQUEST MODAL -->
    <div id="request-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 modal-overlay opacity-0 transition-opacity duration-300">
        <div class="bg-vibe-darkgrey w-full max-w-lg rounded-2xl shadow-2xl border border-gray-700 transform scale-95 transition-transform duration-300" id="modal-content">
            <div class="flex justify-between items-center p-4 border-b border-gray-800 bg-black/50 rounded-t-2xl">
                <div class="flex items-center gap-2"><span class="w-2 h-6 bg-vibe-red rounded-full"></span><h3 class="text-xl font-bold text-white font-montserrat">REQUEST A SONG</h3></div>
                <button id="close-modal-btn" class="text-gray-400 hover:text-white p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            </div>
            <div class="p-0 bg-white rounded-b-xl overflow-hidden relative" id="request-container"></div>
        </div>
    </div>

    <!-- POINTS/REWARDS MODAL -->
    <div id="points-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4 modal-overlay opacity-0 transition-opacity duration-300">
        <div class="bg-vibe-darkgrey w-full max-w-md h-[80vh] rounded-2xl shadow-2xl border border-gray-700 flex flex-col transform scale-95 transition-transform duration-300">
            <!-- Header -->
            <div class="flex justify-between items-center p-4 border-b border-gray-800 bg-black/50 rounded-t-2xl shrink-0">
                <div class="flex items-center gap-2"><span class="w-2 h-6 bg-yellow-400 rounded-full"></span><h3 class="text-xl font-bold text-white font-montserrat">VIBE REWARDS</h3></div>
                <button id="close-points-btn" class="text-gray-400 hover:text-white p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            </div>
            
            <!-- Content -->
            <div class="flex-1 overflow-y-auto p-4 custom-scrollbar">
                <!-- Login View -->
                <div id="login-view" class="flex flex-col items-center justify-center h-full space-y-6">
                    <div class="text-center space-y-2"><h2 class="text-xl font-bold text-white">‡∏™‡∏∞‡∏™‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h2><p class="text-gray-400 text-sm">‡∏ü‡∏±‡∏á‡πÄ‡∏û‡∏•‡∏á‡∏ó‡∏∏‡∏Å 1 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏£‡∏±‡∏ö‡∏ü‡∏£‡∏µ 1 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô!</p></div>
                    <input type="tel" id="phone-input" placeholder="‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏°)" class="w-full bg-black/50 border border-gray-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-vibe-red text-center tracking-widest text-lg">
                    <button id="login-submit-btn" class="w-full bg-vibe-red hover:bg-red-700 text-white font-bold py-3 rounded-lg transition-all shadow-lg shadow-vibe-red/20">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏∞‡∏™‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
                    <p id="login-error" class="text-red-500 text-xs hidden">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</p>
                </div>

                <!-- Dashboard View -->
                <div id="dashboard-view" class="hidden space-y-6">
                    <!-- Points Card -->
                    <div class="bg-gradient-to-r from-yellow-600 to-yellow-400 rounded-2xl p-6 text-black relative overflow-hidden">
                        <div class="relative z-10">
                            <p class="text-xs font-bold opacity-80 uppercase">My Points</p>
                            <h2 class="text-4xl font-extrabold mt-1" id="current-points">0</h2>
                            <p class="text-xs mt-2 font-medium bg-black/20 inline-block px-2 py-1 rounded">User: <span id="user-phone-display">...</span></p>
                        </div>
                        <div class="absolute right-[-20px] bottom-[-20px] opacity-20">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-32 w-32" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                        </div>
                    </div>

                    <!-- Rewards List -->
                    <div>
                        <h3 class="text-white font-bold mb-4 flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-vibe-red" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7" /></svg> ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h3>
                        <div id="rewards-list" class="space-y-3">
                            <div class="text-center py-8 text-gray-500 animate-pulse">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <audio id="radio-player" preload="none">Browser ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö</audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const API_URL = "https://script.google.com/macros/s/AKfycbyusUkCTYP4kSM5ZN1naqVkTAuzbEmiD1p_As6FbCfVXvr_XWgLGDk0I4DSDe_aivDu0g/exec"; 
            const STATION_ID = "sbf4f79825"; 
            const urls = {
                stream: `https://streaming.radio.co/${STATION_ID}/listen`,
                status: `https://public.radio.co/stations/${STATION_ID}/status`,
                nextScript: `https://embed.radio.co/embed/${STATION_ID}/next.js`,
                songScript: `https://embed.radio.co/embed/${STATION_ID}/song.js`
            };
            const defaultArtwork = "https://img2.pic.in.th/1000074512.png";
            
            // --- DOM ---
            const player = document.getElementById('radio-player');
            const playBtn = document.getElementById('play-btn');
            const iconPlay = document.getElementById('icon-play');
            const iconPause = document.getElementById('icon-pause');
            const volumeSlider = document.getElementById('volume-slider');
            const artworkImage = document.getElementById('artwork-image');
            const trackArtistEl = document.getElementById('track-artist');
            const trackTitleEl = document.getElementById('track-title');
            const nextSongDisplayEl = document.getElementById('next-song-display');
            const djImageEl = document.getElementById('dj-image');
            const djNameEl = document.getElementById('dj-name');
            const djTimeEl = document.getElementById('dj-time');

            // --- DJ CONFIG ---
            const djSchedule = [
                { days: [0, 6], start: 9, end: 15, name: "DJ KRIT", timeLabel: "SAT-SUN 09.00-15.00", image: "https://lh3.googleusercontent.com/d/1c7-F8m-Q51qCx7oRLSa6zYhXsKKVAocA" },
                { days: [1, 2, 3, 4, 5], start: 18, end: 22, name: "DJ KRIT", timeLabel: "MON-FRI 18.00-22.00", image: "https://lh3.googleusercontent.com/d/1c7-F8m-Q51qCx7oRLSa6zYhXsKKVAocA" }
            ];
            const defaultDJ = { name: "VIBE 24", timeLabel: "Hits 24 Hours", image: "https://img5.pic.in.th/file/secure-sv1/vide-djb72e78e3ef1fd50e.png" };

            // --- POINTS ---
            let currentUser = localStorage.getItem('vibe_user_phone');
            let currentPoints = 0;
            let pointTimer = null;
            let isPlaying = false;

            // --- FUNCTIONS ---
            function fetchRadioScripts() {
                // Iframe Scraper to sync Current and Next
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
                
                const songSrc = `${urls.songScript}?t=${Date.now()}`;
                const nextSrc = `${urls.nextScript}?t=${Date.now()}`;

                const doc = iframe.contentWindow.document;
                doc.open();
                doc.write(`<html><body>
                    <div id="song-data"><script src="${songSrc}"><\/script></div>
                    <div id="next-data"><script src="${nextSrc}"><\/script></div>
                </body></html>`);
                doc.close();

                iframe.onload = function() {
                    try {
                        const songDiv = iframe.contentWindow.document.getElementById('song-data');
                        const nextDiv = iframe.contentWindow.document.getElementById('next-data');
                        if (songDiv) processCurrentSong(songDiv.innerText);
                        if (nextDiv) processNextSong(nextDiv.innerText);
                    } catch (e) {}
                    setTimeout(() => { if(document.body.contains(iframe)) document.body.removeChild(iframe); }, 100);
                };
            }

            function processCurrentSong(text) {
                if (!text) return;
                text = text.trim();
                let artist = "VIBE 24", title = text;
                const sep = /\s*-\s*|\s*‚Äì\s*/;
                if(sep.test(text)) {
                    const p = text.split(sep);
                    artist = p[0].trim();
                    title = p.slice(1).join(" - ").trim();
                }
                
                // Pattern Filters
                if (/^<[\.\s]*>$/.test(title) || title.includes("<...........>") || (title.includes("<") && title.includes(">"))) {
                    title = "MUSIC STATION";
                    artist = "VIBE 24";
                }

                if (trackArtistEl.textContent !== artist) trackArtistEl.textContent = artist;
                if (trackTitleEl.textContent !== title) {
                    trackTitleEl.textContent = title;
                    if(artworkImage) {
                         if(title.length > 20) artworkImage.classList.add('art-shrink'); else artworkImage.classList.remove('art-shrink');
                    }
                }
            }

            function processNextSong(text) {
                if (!text) return;
                text = text.trim();
                // Filter "Loading..." but allow others
                if (text.includes("Loading") || text === "...") return;
                
                // Ensure placeholder text if garbage
                if (/^<[\.\s]*>$/.test(text) || (text.includes("<") && text.includes(">"))) {
                    // Don't update if it's already generic
                } else {
                    if (nextSongDisplayEl.textContent !== text) nextSongDisplayEl.textContent = text;
                }
            }

            async function updateTrackData() {
                // Get Artwork
                let artworkUrl = defaultArtwork;
                try {
                    const res = await fetch(`${urls.status}?t=${Date.now()}`);
                    if(res.ok) {
                        const d = await res.json();
                        const t = d.current_track || {};
                        if(t.artwork_url_large && t.artwork_url_large !== 'null') artworkUrl = t.artwork_url_large;
                        else if(t.artwork_url && t.artwork_url !== 'null') artworkUrl = t.artwork_url;
                    }
                } catch(e){}
                if (artworkImage && artworkImage.src !== artworkUrl) artworkImage.src = artworkUrl;

                // Get Text
                fetchRadioScripts();
            }

            // --- STANDARD LOGIC ---
            function togglePlay() {
                if (isPlaying) {
                    player.pause(); player.src=""; player.load();
                    isPlaying=false; iconPlay.classList.remove('hidden'); iconPause.classList.add('hidden');
                    stopPointTimer();
                } else {
                    player.src = urls.stream; player.load();
                    player.play().then(() => {
                        isPlaying=true; iconPlay.classList.add('hidden'); iconPause.classList.remove('hidden');
                        updateTrackData(); startPointTimer();
                    }).catch(e => { if(e.name!=='AbortError') alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏û‡∏•‡∏á‡πÑ‡∏î‡πâ"); });
                }
            }
            playBtn.addEventListener('click', togglePlay);
            volumeSlider.addEventListener('input', (e) => player.volume = e.target.value);
            player.addEventListener('error', (e) => {
                if(isPlaying) { isPlaying=false; iconPlay.classList.remove('hidden'); iconPause.classList.add('hidden'); alert("Connection Error"); }
            });

            // --- DJ ---
            function updateDJCard() {
                const now = new Date(); const day = now.getDay(); const hour = now.getHours();
                let show = djSchedule.find(s => s.days.includes(day) && hour >= s.start && hour < s.end);
                let name = show ? show.name : defaultDJ.name;
                let time = show ? show.timeLabel : defaultDJ.timeLabel;
                let img = show ? show.image : defaultDJ.image;
                let isLive = !!show;

                if (djNameEl.textContent !== name || djImageEl.src !== img) {
                    djNameEl.textContent = name; djTimeEl.textContent = time; djImageEl.src = img;
                    djImageEl.style.objectFit = isLive ? "cover" : "contain";
                    djImageEl.style.objectPosition = isLive ? "top" : "center";
                    djImageEl.style.padding = isLive ? "0" : "10px";
                    djImageEl.style.backgroundColor = isLive ? "transparent" : "#000";
                }
            }

            // --- POINTS UI ---
            const pointsBtn = document.getElementById('points-btn');
            const pointsModal = document.getElementById('points-modal');
            const loginView = document.getElementById('login-view');
            const dashboardView = document.getElementById('dashboard-view');
            
            if(currentUser) { pointsBtn.classList.remove('hidden'); fetchUserPoints(); } else pointsBtn.classList.remove('hidden');
            
            pointsBtn.addEventListener('click', () => {
                pointsModal.classList.remove('hidden'); setTimeout(()=>pointsModal.classList.remove('opacity-0'),10);
                pointsModal.querySelector('div').classList.add('scale-100');
                if(currentUser) showDashboard(); else showLogin();
            });
            document.getElementById('close-points-btn').addEventListener('click', () => {
                pointsModal.classList.add('opacity-0'); setTimeout(()=>pointsModal.classList.add('hidden'),300);
            });

            function showLogin() { loginView.classList.remove('hidden'); dashboardView.classList.add('hidden'); }
            function showDashboard() { loginView.classList.add('hidden'); dashboardView.classList.remove('hidden'); document.getElementById('user-phone-display').textContent=currentUser; updatePointsUI(currentPoints); fetchRewards(); }
            function updatePointsUI(p) { currentPoints=p; document.getElementById('current-points').textContent=p; document.getElementById('user-points-display').textContent=`${p} PTS`; }
            
            document.getElementById('login-submit-btn').addEventListener('click', () => {
                const p = document.getElementById('phone-input').value.trim();
                if(p.length<9) return alert("‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
                fetch(`${API_URL}?action=login&phone=${p}`).then(r=>r.json()).then(d=>{
                    currentUser=p; localStorage.setItem('vibe_user_phone',p); currentPoints=d.data.points; showDashboard(); if(isPlaying) startPointTimer();
                });
            });

            function fetchUserPoints() { if(API_URL && currentUser) fetch(`${API_URL}?action=login&phone=${currentUser}`,{method:'POST'}).then(r=>r.json()).then(d=>updatePointsUI(d.data.points)); }
            function fetchRewards() { fetch(`${API_URL}?action=getRewards`).then(r=>r.json()).then(d=>renderRewards(d.data)); }
            function renderRewards(list) {
                const el = document.getElementById('rewards-list'); el.innerHTML='';
                list.forEach(r => el.innerHTML+=`<div class="reward-card rounded-xl p-3 flex items-center gap-4"><img src="${r.image}" class="w-16 h-16 rounded-lg bg-gray-800"><div class="flex-1"><h4 class="font-bold text-white text-sm">${r.name}</h4><p class="text-yellow-400 text-xs">${r.cost} Points</p></div><button onclick="redeem(${r.id},${r.cost},'${r.name}')" class="bg-white text-black text-xs font-bold px-3 py-2 rounded">‡πÅ‡∏•‡∏Å</button></div>`);
            }
            window.redeem = (id,c,n) => { if(currentPoints<c) return alert("‡πÅ‡∏ï‡πâ‡∏°‡πÑ‡∏°‡πà‡∏û‡∏≠"); if(confirm(`‡πÅ‡∏•‡∏Å ${n}?`)) fetch(`${API_URL}?action=redeem&phone=${currentUser}&cost=${c}&rewardName=${n}`,{method:'POST'}).then(r=>r.json()).then(d=>{if(d.status==='success'){updatePointsUI(d.points);alert("‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");}else alert(d.message)}); };

            function startPointTimer() {
                if(pointTimer) clearInterval(pointTimer); if(!currentUser) return;
                pointTimer = setInterval(() => { if(isPlaying) { updatePointsUI(parseInt(currentPoints)+1); fetch(`${API_URL}?action=addPoint&phone=${currentUser}`,{method:'POST'}); } }, 60000);
            }
            function stopPointTimer() { if(pointTimer) clearInterval(pointTimer); pointTimer=null; }

            // --- REQUEST & SHARE ---
            const reqModal = document.getElementById('request-modal');
            document.getElementById('open-request-btn').addEventListener('click', () => {
                reqModal.classList.remove('hidden'); setTimeout(()=>reqModal.classList.remove('opacity-0'),10); reqModal.querySelector('div').classList.add('scale-100');
                const rc = document.getElementById('request-container');
                if(!rc.querySelector('iframe')) rc.innerHTML = `<iframe src="https://embed.radio.co/request/w75f0bc0" width="100%" height="600" style="border:none;"></iframe>`;
            });
            document.getElementById('close-modal-btn').addEventListener('click', () => { reqModal.classList.add('opacity-0'); setTimeout(()=>reqModal.classList.add('hidden'),300); });
            
            document.getElementById('share-btn').addEventListener('click', async () => {
                const t = `üéµ VIBE 24: ${trackTitleEl.textContent}`;
                if(navigator.share) try{await navigator.share({title:'VIBE 24',text:t,url:location.href});}catch(e){} else {try{await navigator.clipboard.writeText(t+" "+location.href);alert("Copied!");}catch(e){}}
            });

            // Init
            updateTrackData(); setInterval(updateTrackData, 10000);
            updateDJCard(); setInterval(updateDJCard, 60000);
        });
    </script>
</body>
</html>
